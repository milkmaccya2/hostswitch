# HostSwitch 改善タスクリスト

## 完了したタスク ✅

### ~~1. Vitestを使用したテストフレームワークの導入とユニットテストの実装~~
**完了日**: 2025-07-19  
**実装内容**: 
- Vitestテストフレームワークの導入とカバレッジレポート機能
- t-wadaのTDD原則に基づく包括的なテストスイートの実装
- 全121個のテスト（Core: 50個、Infrastructure: 30個、CLI: 24個、Config: 7個、統合: 10個）
- Core層100%、Infrastructure層100%、CLI Commands層100%、Config層100%のカバレッジ達成
- 全体カバレッジ88.2%達成
- モック実装による隔離テスト、エラーハンドリングテスト
- クリーンアーキテクチャ対応のリファクタリング（ProfileManager、CurrentProfileManager、BackupManager分離）

### ~~2. TypeScriptへの移行（型定義、tsconfig.json、ビルド設定）~~ 
**完了日**: 2025-07-19  
**実装内容**: 
- TypeScript環境の構築（tsconfig.json、型定義の追加）
- src/hostswitch.tsへの移行完了
- ビルドプロセスの確立（dist/ディレクトリへの出力）
- package.jsonスクリプトの更新
- ドキュメントの更新

### ~~5. Windowsサポートの完全実装（hostsパス、権限処理）~~
**完了日**: 2025-07-19  
**実装内容**: 
- プラットフォーム自動検出機能の実装
- Windowsのhostsファイルパス（C:\Windows\System32\drivers\etc\hosts）への対応

## 高優先度タスク

### ~~3. sudoが必要な操作の自動検出と自動sudo実行~~
**完了日**: 2025-07-19  
**実装内容**: 
- IPermissionCheckerインターフェースとPermissionCheckerクラスの実装
- HostSwitchServiceへの権限チェック機能統合
- sudo自動再実行機能（npm経由・直接実行両対応）
- 権限チェック関連の包括的テスト実装（14テスト、100%カバレッジ）
- 全149テスト通過、88.06%全体カバレッジ達成

### 4. hostsファイル内容のバリデーション機能
**理由**: 不正な形式のhostsファイルはシステムに悪影響を与える可能性がある。バリデーションにより、安全性を確保できる。

## 中優先度タスク

### ~~9. インタラクティブモードの実装（inquirer.js使用）~~ ✅
**完了日**: 2025-07-26  
**実装内容**: 
- inquirer.jsを使用したインタラクティブモードの実装
- InteractiveUserInterfaceクラスによるユーザーフレンドリーなメニュー表示
- 矢印キーでの操作、視覚的なプロファイル状態表示
- sudo検出と適切なエラーハンドリング
- 破壊的操作への確認プロンプト

### ~~23. クリーンアーキテクチャとCommand Patternの実装~~ ✅
**完了日**: 2025-07-26  
**実装内容**: 
- CliApplicationをCliControllerに置き換え（Command Pattern実装）
- HostSwitchFacadeによるビジネス操作の統一インターフェース
- IUserInterfaceの抽象化とCLI/Interactive実装の分離
- 各操作用の個別Commandクラス（List, Create, Switch, Edit, Show, Delete）
- 旧コンポーネント（CliApplication, CommandHandler, 旧InteractiveMode）の削除
- 新アーキテクチャに対応した包括的なテストスイート
- SOLID原則に基づいた設計でテスタビリティと保守性が向上

### 6. エラーハンドリングの統一化とカスタムエラークラスの実装
**理由**: 現在のエラー処理が統一されておらず、デバッグが困難。統一的なエラー処理により、問題の特定と解決が容易になる。

### 7. ロギングシステムの実装（debugモード、操作履歴）
**理由**: 問題発生時の調査が困難。ログにより、トラブルシューティングが効率的に行える。

### ~~8. コード品質とフォーマットツールの設定~~ ✅
**完了日**: 2025-07-26  
**実装内容**: 
- BiomeをESLint+Prettierの代替として導入
- 単一設定ファイル（biome.json）でlinting + formatting + import sorting を統合管理
- 10-100倍高速なパフォーマンス、TypeScript完全対応
- 37ファイルの自動修正、コードスタイル統一完了
- VSCode統合設定追加、開発効率大幅向上
- npm scriptsにlint、format、checkコマンド追加

### 10. プロファイルのインポート/エクスポート機能
**理由**: チーム間でプロファイルを共有する手段がない。この機能により、設定の共有と移行が容易になる。

### 11. プロファイル名のサニタイゼーション
**理由**: 特殊文字を含むプロファイル名により、ファイルシステムエラーが発生する可能性がある。安全性の向上。

### 12. 設定ファイル機能の実装（.hostswitchrc）
**理由**: ユーザーごとのカスタマイズができない。設定ファイルにより、個別の環境に合わせた柔軟な設定が可能になる。

### 13. JSDocコメントの追加
**理由**: コードの意図が不明瞭。適切なドキュメントにより、保守性と拡張性が向上する。

### 14. pre/post switchフックの実装
**理由**: プロファイル切り替え時に追加の処理（キャッシュクリアなど）を行いたいニーズがある。フックにより、柔軟な拡張が可能になる。

## 低優先度タスク

### 15. プログレスバー/スピナーの追加（ora使用）
**理由**: 処理中であることが視覚的にわからない。ユーザー体験の向上につながる。

### 16. プロファイルの差分表示機能（diff）
**理由**: 現在のhostsとプロファイルの違いが確認できない。切り替え前に変更内容を確認できることで、安心して操作できる。

### 17. コマンド補完スクリプトの作成（bash/zsh）
**優先度**: 中  
**理由**: コマンドやプロファイル名の入力が面倒。補完により、効率的な操作が可能になる。現在READMEに記載されているが未実装。
**実装内容**: 
- bash/zsh向けの補完スクリプト作成
- `hostswitch show <tab>` でプロファイル名候補を表示
- サブコマンド補完（list, create, switch, delete, etc.）
- インストール手順のドキュメント化

### 26. 誤解を招くbash補完の記述修正 ✅
**完了日**: 2025-07-26  
**理由**: README.mdとREADME.ja.mdにbash補完機能の記述があったが、実際には実装されていない機能だった。
**実装内容**: 
- README.mdとREADME.ja.mdから誤解を招くbash補完の記述を削除
- タスク#17として正式に実装予定項目に追加

### 18. 環境変数によるカスタマイズサポート
**理由**: システム全体の設定変更なしに個人設定を行いたい。環境変数により、柔軟な設定が可能になる。

### 19. API使用例とプログラム的な利用方法のドキュメント作成
**理由**: 他のツールから利用したいニーズがある。APIドキュメントにより、エコシステムの拡大が期待できる。

### 20. 詳細なトラブルシューティングガイドの作成
**理由**: 問題発生時の解決方法が不明。ガイドにより、ユーザーが自己解決できるようになる。

### 21. プラグインシステムの設計と実装
**理由**: カスタム機能を追加したいニーズがある。プラグインにより、本体を変更せずに機能拡張が可能になる。

### 22. Git連携機能（プロファイルのバージョン管理）
**理由**: プロファイルの変更履歴を追跡できない。Git連携により、変更管理と共同作業が容易になる。

## 実装順序の推奨

1. **第1フェーズ（基盤整備）**: ~~TypeScript化~~、~~テスト導入~~、ESLint設定
2. **第2フェーズ（安定性向上）**: エラーハンドリング、バリデーション、ロギング
3. **第3フェーズ（ユーザビリティ）**: インタラクティブモード、~~Windows対応~~、~~sudo検出~~
4. **第4フェーズ（拡張機能）**: インポート/エクスポート、フック、設定ファイル
5. **第5フェーズ（付加価値）**: プラグイン、Git連携、高度な機能

この順序により、基盤から着実に改善を進め、安定性を保ちながら機能を拡張できます。

## 進捗状況

- **第1フェーズ**: 3/3 完了（TypeScript化✅、テスト導入✅、コード品質ツール✅）
- **第3フェーズ**: 3/3 完了（Windows対応✅、sudo検出✅、インタラクティブモード✅）
- **アーキテクチャ改善**: クリーンアーキテクチャとCommand Patternの実装✅
- **パッケージ最適化**: npm公開時の不要ファイル除外✅

## 新たに発見された課題

### 24. テストカバレッジの向上
**優先度**: 中  
**理由**: 現在のテストカバレッジが88.2%で、特にUI層とエラーハンドリング部分でカバレッジが不足している。100%を目指すことで、より安定したソフトウェアを提供できる。
**対象ファイル**: 
- `src/cli/ui/CliUserInterface.ts` - エラーハンドリング部分
- `src/cli/ui/InteractiveUserInterface.ts` - 一部のエラーパス
- `src/infrastructure/PermissionChecker.ts` - Windowsプラットフォーム固有の処理

### 25. npm公開時の不要ファイル除外 ⚠️ 
**優先度**: 高（すぐ対応）  
**理由**: 現在`src/__mocks__/`ディレクトリがnpm公開パッケージに含まれており、パッケージサイズの無駄遣いとなっている。テストモックファイルは本番環境では不要。
**対応内容**: package.jsonのfilesフィールドで`__mocks__`を除外、またはnpmignoreファイルの設定

## 次に取り組むべきタスク

1. **エラーハンドリングの統一化**（第2フェーズ開始）
2. **hostsファイル内容のバリデーション機能**（高優先度タスク）
3. **テストカバレッジの向上**（品質向上）
4. **ロギングシステムの実装**（第2フェーズ継続）